{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["/**\n * @desc 全局通用发布-订阅模式\n * \t\t可支持：1、先发布(or触发事件)后订阅(or注册事件)\n * \t\t\t\t\t 2、新增命名空间 \n */ \nconst EventEmitter = (function () {\n  var _event,\n    _default = 'default'\n  _event = function () {\n    var _on,\n      _emit,\n      _remove,\n      _create,\n      each,\n      _shift = Array.prototype.shift,\n      _unshift = Array.prototype.unshift,\n      namespaceCache = {} // 命名空间\n    /**\n     * @desc 内部函数 - 遍历\n     * @param {Array} arr\n     * @param {Function} fn fn(index, item)\n     */ \n    each = function (arr, fn) {\n      var ret\n      for (var index = 0, len = arr.length; index < len; index++) {\n        var item = arr[index] \n        ret = fn.call(item, index, item) // 将回调函数fn的this指向item \n      }\n      return ret\n    }\n\n    /**\n     * @desc 内部函数 - 注册事件\n     * @param {String} key 事件名\n     * @param {Function} fn 事件函数\n     * @param {Object} cache 某个命名空间下存放多个事件栈的对象\n     */ \n    _on = function (key, fn, cache) {\n      if (!cache[key]) {\n        cache[key] = []\n      }\n      cache[key].push(fn)\n    }\n\n    /**\n     * @desc 内部函数 - 触发事件\n     * @param {Object} cache 某个命名空间下存放多个事件栈的对象\n     * @param {String} key 事件名\n     * @param {Arguments} ...args 回调函数所需参数\n     */ \n    _emit = function () {\n      var cache = _shift.call(arguments),\n        key = _shift.call(arguments),\n        args = arguments,\n        _self = this,\n        stack = cache[key] \n      if (!stack || !stack.length) { // 触发的某个事件的事件栈里若没函数\n        return\n      }      \n      return each(stack, function () { // 有则遍历\n        // 下面this指向stack中的每一项\n        // 然后再指向_emit函数\n        return this.apply(_self, args)\n      })\n    }\n\n    /**\n     * @desc 内部函数 - 移除某个或所有注册事件\n     * @param {String} key 事件名\n     * @param {Function} fn 事件函数\n     * @param {Object} cache 某个命名空间下存放多个事件栈的对象\n     */ \n    _remove = function (key, fn, cache) {      \n      if (cache[key]) { // 有注册过才会删除        \n        if (fn) { // 若传了特定函数，删除特定\n          for (var i = cache[key].length; i >= 0; i--) { // 反向遍历\n            if (cache[key] === fn) {\n              cache[key].splice(i, 1)\n            }            \n          }\n        } else { // 否则删除所有注册函数 \n          cache[key] = []\n        }\n      }\n    }\n\n    /**\n     * @desc 内部函数 - 创建命名空间 核心函数\n     * @param {String} namespace 默认值为 _default\n     */ \n    _create = function (namespace) {\n      namespace = namespace || _default\n      var cache = {},\n        offlineStack = [], // 离线事件 - 主要是为了实现先调用后注册\n        ret = {\n          on: function (key, fn, last) {\n            _on(key, fn, cache)              \n            if (offlineStack === null) { // 注册过了 则不进行下面的\n              return\n            }\n            // 没有注册就触发了事件 \n            // 在emit函数中将触发事件 离线缓存到了offlineStack\n            if (last === 'last') {                \n              offlineStack.length && offlineStack.pop()() // 订阅时只会读取最新一次注册事件 携带的参数\n            } else {\n              // 遍历触发离线缓存的事件栈\n              each(offlineStack, function () {                  \n                this() // 下面this指向offlineStack中的每一项\n              })\n            }              \n            offlineStack = null // 置为null 表示已经注册过了\n          },\n\n          one: function (key, fn, last) {\n            _remove(key, cache)\n            this.on(key, fn, last)\n          },\n\n          emit: function () {\n            var fn,\n              args,\n              _self = this            \n            _unshift.call(arguments, cache) // 将 某个命名空间下存放多个事件栈的对象cache 放到参数队头\n            args = arguments\n            // 调用事件\n            fn = function () {\n              return _emit.apply(_self, args)\n            }              \n            if (offlineStack) { // offlineStack为[]时，为未注册先调用，将事件fn放进 离线事件栈offlineStack中\n              return offlineStack.push(fn)\n            }\n            return fn() // 否则触发事件\n          },\n\n          remove: function (key, fn) {\n            _remove(key, cache, fn)\n          }\n        }\n      // 缓存命名空间 \n      return namespace ? \n        (namespaceCache[namespace] ?\n          namespaceCache[namespace] :\n          namespaceCache[namespace] = ret) :\n        ret\n    }\n\n    /**\n     * @desc 对外暴露API\n     */ \n    return {      \n      create: _create, // 创建命名空间\n      \n      // 以下均使用默认的命名空间\n      /**\n       * @desc 注册事件\n       * @param {String} key\n       * @param {Function} fn\n       * @param {String} last 先调用后注册场景下，注册时只会读取最新一次注册事件 携带的参数\n       */       \n      on: function (key, fn, last) {\n        var event = this.create()\n        event.on(key, fn, last)\n      },\n\n      /**\n       * @desc 单例\n       * 参数同 on\n       */       \n      one: function (key, fn, last) {\n        var event = this.create()\n        event.one(key, fn, last)\n      },\n\n      /**\n       * @desc 触发事件\n       * @param {String} key \n       * @param {Arguments} args 触发时带的参数\n       */       \n      emit: function () {\n        var event = this.create()\n        event.emit.apply(this, arguments)\n      },\n\n      /**\n       * @desc 移除某个事件的某个或所有注册函数\n       * @param {String} key 某个事件\n       * @param {Function} fn 传则移除某个事件，否则移除所有事件\n       */       \n      remove: function (key, fn) {\n        var event = this.create()\n        event.remove(key, fn)\n      }\n    }\n  }()\n  return _event\n})()\nexport default EventEmitter"],"names":["EventEmitter","_event","_default","_on","_emit","_remove","_create","each","_shift","Array","prototype","shift","_unshift","unshift","namespaceCache","arr","fn","ret","index","len","length","item","call","key","cache","push","arguments","args","_self","stack","apply","i","splice","namespace","offlineStack","on","last","pop","one","emit","remove","create","event"],"mappings":"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"}